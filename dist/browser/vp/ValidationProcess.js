'use strict';var _slicedToArray2=require("babel-runtime/helpers/slicedToArray"),_slicedToArray3=_interopRequireDefault(_slicedToArray2),_entries=require("babel-runtime/core-js/object/entries"),_entries2=_interopRequireDefault(_entries),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var _=require("lodash"),_require=require("@identity.com/uca"),definitions=_require.definitions,UserCollectableAttribute=_require.UserCollectableAttribute,_require2=require("./ValidationErrors"),BadUCAValueError=_require2.BadUCAValueError,BadValidationProcessError=_require2.BadValidationProcessError,BadValidationUCAError=_require2.BadValidationUCAError,validIdentifiers=definitions.map(function(a){return a.identifier}),defaultUcaVersion="1",ValidationUCAValue=function(){function a(b,c,d){if((0,_classCallCheck3.default)(this,a),this.name=b,!this.name)throw new Error("you must provide a name for the UCA");this.ucaVersion=d,this.setValue(c)}return(0,_createClass3.default)(a,[{key:"setValue",value:function(a){if(this.name&&_.includes(validIdentifiers,this.name))try{new UserCollectableAttribute(this.name,a,this.ucaVersion)}catch(b){throw new BadUCAValueError(this.name,a,b)}this.value=a}},{key:"serialize",value:function(){return{value:this.value}}}]),a}(),ValidationUCA=function(){function a(b,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:defaultUcaVersion,e=arguments[3];(0,_classCallCheck3.default)(this,a);var f=function(a,b){var c=_.get(a,b);if(c)return c;throw new BadValidationUCAError(b+" not present in "+a)};this.ucaMapId=b,this.ucaName=f(c,"name"),this.status=f(c,"status"),this.ucaVersion=d,this.dependsOnStatus=e,this.dependsOn=_.get(c,"dependsOn",[])}return(0,_createClass3.default)(a,[{key:"getValueObj",value:function(a){var b=new ValidationUCAValue(this.ucaName,a,this.ucaVersion);return b.serialize()}},{key:"url",get:function(){return"ucas/"+this.ucaMapId}},{key:"dependsOnArray",get:function(){var b=this;return this.dependsOnValidationUcas=!this.dependsOnValidationUcas&&this.dependsOn&&0<this.dependsOn.length?_.map(this.dependsOn,function(c){return new a(null,c.uca,b.ucaVersion,c.status)}):[],this.dependsOnValidationUcas}}]),a}(),ValidationProcess=function(){function a(b){(0,_classCallCheck3.default)(this,a);var c=function(a,b){var c=_.get(a,b);if(c)return c;throw new BadValidationProcessError(b+" not present in "+a)};this.id=c(b,"id"),this.credentialItem=c(b,"state.credential"),this.processUrl=c(b,"processUrl"),this.status=c(b,"state.status"),this.ucaVersion=c(b,"state.ucaVersion"),this.ucas=c(b,"state.ucas")}return(0,_createClass3.default)(a,[{key:"getValidationUcas",value:function(){var a=this;return this.validationUcas||(this.validationUcas=_.map((0,_entries2.default)(this.ucas),function(b){var c=(0,_slicedToArray3.default)(b,2),d=c[0],e=c[1];return new ValidationUCA(d,e,a.ucaVersion)})),this.validationUcas}},{key:"getValidationUcasByStatus",value:function(a){return _.filter(this.getValidationUcas(),function(b){return b.status===a})}}]),a}();module.exports={ValidationProcess:ValidationProcess,ValidationUCA:ValidationUCA,ValidationUCAValue:ValidationUCAValue,BadUCAValueError:BadUCAValueError};